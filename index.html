<!DOCTYPE html>
<meta charset="utf-8">
<style>

	body {
		font: 15px sans-serif;
		cursor: crosshair;
		margin: 0;
	}
	.axis path,
	.axis line {
		fill: none;
		stroke: #000;
		shape-rendering: crispEdges;
	}
	.dot {
		stroke: #000;
		stroke-width: 0.1;
	}
	div.tooltip {
		position: absolute;
		text-align: center;
		padding: 5px;
		font-family: Avenir, serif;
		background: slategray;
		color: white;
		border: 1px;
		border-radius: 5px;
		pointer-events: none;
	}
	.title {
		font-size: 3em;
	}
	.label {
		font-family: Avenir, serif;
	}
	table {
		width: 100%;
		margin: auto;
		border-collapse: collapse;
	}
	th, td {
		border: 1px solid white;
		border-radius: 5px;
	}
	h2 {
		display: inline;
		padding-top: 0px;
		padding-right: 30px;
		padding-left: 0px;
		padding-bottom: 0px;
	}
	img {
		vertical-align: middle;
		horiz-align: right;
	}
	.tt {
		margin: 5px;
	}
	.navBar ul {
		background: #263238;
		list-style: none;
		padding: 0;
		margin: 0;
		overflow: auto;
		text-align: center;
		vertical-align: middle;
	}
	.navBar li {
		float: left;
	}
	.navBar li a {
		height: 22px;
		display: inline-block;
		color: #f2f2f2;
		text-align: center;
		padding: 14px 16px;
		text-decoration: none;
		font-size: 17px;
	}
	.navBar li.rli a {
		height: 50px;
		display: inline-block;
		color: #f2f2f2;
		text-align: center;
		padding: 0;
		text-decoration: none;
		font-size: 17px;
	}
	.active {
		box-shadow: 0 -5px 0 #4DD0E1 inset;
	}
	/*.navBar li a:hover {*/
	/*background: #37474F;*/
	/*!*box-shadow: 0 -5px 0 #4DD0E1 inset;*!*/
	/*}*/
	a:hover {
		background: #37474F;
		/*box-shadow: 0 -5px 0 #4DD0E1 inset;*/
	}
	.navBar img {
		padding: 5px;
		height: 40px;
		vertical-align: middle;
	}


</style>
<body>
	<!--&lt;!&ndash;<div class="navBar">&ndash;&gt;-->
	<!--&lt;!&ndash;<ul>&ndash;&gt;-->
	<!--<li><a href="https://dsalopek.github.io/baseball-analysis/" id="scatter-link" class="active">Scatter</a></li>-->
	<!--<li><a href="https://dsalopek.github.io/baseball-map/" id="map-link">Map</a></li>-->
	<!--&lt;!&ndash;<li><a class="rli" href="" style="float: right"><img src="./logos/github-white.png" alt="github"></a></li>&ndash;&gt;-->
	<!--&lt;!&ndash;</ul>&ndash;&gt;-->
	<!--&lt;!&ndash;</div>&ndash;&gt;-->
	<div class="navBar">
		<ul>
			<li><a href="https://dsalopek.github.io/baseball-analysis/" id="scatter-link" class="active">Scatter</a>
			</li>
			<li><a href="baseball-map/index.html" id="map-link">Map</a></li>
			<li class="rli" style="float: right;"><a href="https://github.com/dsalopek/baseball-analysis"><img
					src="./logos/github-white.png" alt="github"></a></li>
		</ul>
	</div>
	<script src="//d3js.org/d3.v3.min.js"></script>
	<script>

		var div = d3.select("body").append("div")
			.attr("class", "tooltip")
			.attr("id", "toolt")
			.style("opacity", 0);

		var margin = {top: 20, right: 20, bottom: 50, left: 40},
			width = window.innerWidth - margin.left - margin.right - 20;//1200 - margin.left - margin.right,
		height = (window.innerHeight - margin.top - margin.bottom) - 80;//600 - margin.top - margin.bottom;

		var x = d3.scale.linear()
			.range([0, width - 200]);

		var y = d3.scale.linear()
			.range([height, 40]);

		var color = d3.scale.category20();

		var xAxis = d3.svg.axis()
			.scale(x)
			.orient("bottom");

		var yAxis = d3.svg.axis()
			.scale(y)
			.orient("left");

		var svg = d3.select("body").append("svg")
			.attr("width", width + margin.left + margin.right)
			.attr("height", height + margin.top + margin.bottom)
			.append("g")
			.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

		d3.csv("data.csv", function (error, data) {
			if (error) {
				throw error;
			}

			data.forEach(function (d) {
				d.r = +d.r;
				d.winper = +d.winper;
			});

			x.domain(d3.extent(data, function (d) {
				return d.r;
			})).nice();
			y.domain(d3.extent(data, function (d) {
				return d.winper;
			})).nice();

			svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis)
				.append("text")
				.attr("class", "label")
				.attr("x", width - 200)
				.attr("y", -6)
				.style("text-anchor", "end")
				.text("Runs");

			svg.append("g")
				.attr("class", "y axis")
				.call(yAxis)
				.append("text")
				.attr("class", "label")
				.attr("transform", "rotate(-90)")
				.attr("y", 6)
				.attr("x", -40)
				.attr("dy", ".71em")
				.style("text-anchor", "end")
				.text("Win %");

			svg.append("g")
				.attr("class", "title")
				.attr("transform", "translate(0," + height + ")")
				.append("text")
				.attr("class", "label")
				.attr("x", width / 2)
				.attr("y", -height + 20)
				.style("text-anchor", "middle")
				.text("American-League Batting Statistics");

			svg.selectAll(".dot")
				.data(data)
				.enter().append("circle")
				.attr("class", "dot")
				.attr("r", function (d) {
					return normalize(d.h);
				})
				.attr("cx", function (d) {
					return x(d.r);
				})
				.attr("cy", function (d) {
					return y(d.winper);
				})
				.style("fill-opacity", function (d) {
					return baOpac(d.ba);
				})
				.style("fill", function (d) {
					return color(d.team);
				})

				.on("mouseover", function (d) {
					svg.selectAll(".dot")
						.style("fill-opacity", function (d1) {
							if (d == d1) {
								return baOpac(d.ba);
							}
							else {
								return 0;
							}
						});
					svg.selectAll(".legend")
						.style("opacity", function (d1) {
							if (d.team == d1) {
								return 1;
							}
							else {
								return 0.1;
							}
						});
					div.transition()
						.style("opacity", 1.0);
					div.html("<span id='tt'><div class='tt'><h2>" + d.fname + " " + d.lname + "</h2><img src='./logos/" + d.team + ".png' alt='" + d.name + "_logo' height='50' width='50'></div>" +
						"<table>" +
						"<tr><th>Pos</th><th>AB</th><th>Runs</th><th>Hits</th><th>RBI</th><th>Avg</th></tr>" +
						"<tr><td>" + d.position + "</td>" +
						"<td>" + d.ab + "</td>" +
						"<td> " + d.r + " </td>" +
						"<td> " + d.h + " </td>" +
						"<td> " + d.rbi + " </td>" +
						"<td> " + d.ba + " </td>" +
						"</tr>" +
						"</table></span>")
						.style("left", function () {
							return findsize(d3.event.pageX) + "px";
						})
						.style("top", (d3.event.pageY) + "px")
					findsize();
				})
				.on("mouseout", function (d) {
					svg.selectAll(".dot")
						.style("fill-opacity", function (d1) {
							return baOpac(d1.ba);
						});
					svg.selectAll(".legend")
						.style("opacity", 1);
					div.transition()
						.style("opacity", 0);
				});

			var legend = svg.selectAll(".legend")
				.data(color.domain())
				.enter().append("g")
				.attr("class", "legend")
				.attr("transform", function (d, i) {
					return "translate(0," + i * 25 + ")";
				})
				.on("mouseover", function (d) {
					svg.selectAll(".legend")
						.style("opacity", function (d1) {
							if (d == d1) {
								return 1;
							}
							else {
								return 0.1;
							}
						});
					svg.selectAll(".dot")
						.style("fill-opacity", function (d1) {
							if (d == d1.team) {
								return baOpac(d.ba);
							}
							else {
								return 0;
							}
						})
				})
				.on("mouseout", function (d) {
					svg.selectAll(".legend")
						.style("opacity", 1);
					svg.selectAll(".dot")
						.style("fill-opacity", function (d) {
							return baOpac(d.ba);
						});
				});

			legend.append("circle")
				.attr("cx", width - 115)
				.attr("cy", 70)
				.attr("r", 10)
				.style("fill", color);

			legend.append("text")
				.attr("class", "legtext")
				.attr("x", width - 100)
				.attr("y", 70)
				.attr("dy", ".35em")
				.attr("class", "label")
				.text(function (d) {
					return d;
				});

		});
		function normalize(x) {
			return (x / 216) * 20;
		}
		function baOpac(y) {
			y = y - 0.23;
			y = y / 0.1;
			return (y);
		}
		function findsize(x) {
			if (x < document.getElementById("tt").offsetWidth / 2) {
				return 10;
			} else {
				return x - document.getElementById("tt").offsetWidth / 2;
			}
		}
	</script>
</body>
